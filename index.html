<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é™æ­¢ç”»ãƒ¡ãƒ¼ã‚«ãƒ¼ Pro</title>
    <style>
        :root { --primary: #0070f3; --error: #d93025; --success: #28a745; --bg: #f8f9fa; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: #333; line-height: 1.6; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        h1 { text-align: center; font-size: 1.4rem; margin-bottom: 25px; }
        
        #drop-zone { border: 2px dashed #ddd; border-radius: 12px; padding: 50px 20px; text-align: center; cursor: pointer; transition: 0.2s; background: #fafafa; }
        #drop-zone:hover { border-color: var(--primary); background: #f0f7ff; }
        #drop-zone.disabled { opacity: 0.5; pointer-events: none; }
        
        #status { margin-top: 20px; text-align: center; font-weight: bold; min-height: 24px; }
        .error-text { color: var(--error); }
        
        #preview-area { display: none; margin-top: 25px; text-align: center; border-top: 1px solid #eee; padding-top: 25px; }
        video { max-width: 100%; border-radius: 8px; background: #000; margin-bottom: 15px; }
        
        .tweet-config { text-align: left; margin-bottom: 20px; }
        #tweet-text { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-family: inherit; }

        .btn-group { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
        .btn { padding: 12px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; text-decoration: none; font-size: 14px; flex: 1; min-width: 140px; text-align: center; }
        .btn-dl { background: var(--success); color: white; }
        .btn-tw { background: #000; color: white; }
        
        .note { font-size: 0.75rem; color: #666; background: #fff9db; padding: 10px; border-radius: 6px; margin-top: 15px; text-align: left; }
    </style>
</head>
<body>

<div class="container">
    <h1>é™æ­¢ç”»ãƒ¡ãƒ¼ã‚«ãƒ¼</h1>
    
    <div id="drop-zone">
        <p>ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰<br><span style="font-size: 0.8rem; color: #999;">(ã‚¯ãƒªãƒƒã‚¯ or ãƒ‰ãƒ­ãƒƒãƒ—)</span></p>
        <input type="file" id="file-input" accept="image/*" style="display: none;">
    </div>
    
    <div id="status"></div>

    <div id="preview-area">
        <video id="output-video" controls loop playsinline></video>
        
        <div class="tweet-config">
            <p style="font-size: 0.8rem; margin-bottom: 5px;">ğ• æŠ•ç¨¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</p>
            <textarea id="tweet-text" rows="3">ç”»åƒã‚’å‹•ç”»ã«å¤‰æ›ã—ã¾ã—ãŸã€‚ #é™æ­¢ç”»ãƒ¡ãƒ¼ã‚«ãƒ¼</textarea>
        </div>

        <div class="btn-group">
            <a id="download-link" class="btn btn-dl">â‘  å‹•ç”»ã‚’ä¿å­˜</a>
            <button id="tweet-btn" class="btn btn-tw">â‘¡ ğ•ã§ã‚·ã‚§ã‚¢</button>
        </div>
        
        <div class="note">
            ã€é‡è¦ã€‘ğ•(Twitter)ã®ä»•æ§˜ã§ã€å‹•ç”»ã¯è‡ªå‹•æ·»ä»˜ã•ã‚Œã¾ã›ã‚“ã€‚<br>ã¾ãšã€Œä¿å­˜ã€ã—ã¦ã‹ã‚‰ã€Œã‚·ã‚§ã‚¢ã€ã‚’æŠ¼ã—ã€ã‚¢ãƒ—ãƒªå†…ã§ä¿å­˜ã—ãŸå‹•ç”»ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚
        </div>

        <button onclick="location.reload()" style="margin-top:20px; background:none; border:none; color:#999; text-decoration:underline; cursor:pointer; font-size:0.8rem;">åˆ¥ã®ç”»åƒã‚’è©¦ã™</button>
    </div>
</div>

<script>
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const status = document.getElementById('status');
    const previewArea = document.getElementById('preview-area');
    const videoEl = document.getElementById('output-video');

    dropZone.onclick = () => fileInput.click();
    fileInput.onchange = (e) => { if (e.target.files[0]) processImage(e.target.files[0]); };

    const SIGS = [
        "chatgpt", "dall-e", "openai", "google", "gemini", "deepmind", "imagen",
        "grok", "xai", "midjourney", "nijijourney", "stable diffusion", "automatic1111", 
        "comfyui", "novelai", "civitai", "sdxl", "adobe firefly", "bing image creator", 
        "microsoft designer", "generated by", "created with"
    ];

    async function processImage(file) {
        status.innerText = "æ¤œè¨¼ä¸­...";
        previewArea.style.display = "none";
        dropZone.classList.add('disabled');

        const buffer = await file.arrayBuffer();
        const text = new TextDecoder().decode(new Uint8Array(buffer)).toLowerCase();
        if (SIGS.some(s => text.includes(s))) {
            status.innerHTML = `<span class="error-text">AIç”Ÿæˆç”»åƒã®å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚</span>`;
            dropZone.classList.remove('disabled');
            return;
        }

        status.innerText = "å‹•ç”»ã‚’ç”Ÿæˆä¸­...";

        const img = new Image();
        img.src = URL.createObjectURL(file);
        await new Promise(r => img.onload = r);
		
        const canvas = document.createElement('canvas');
        canvas.width = Math.floor(img.width / 2) * 2;
        canvas.height = Math.floor(img.height / 2) * 2;
        const ctx = canvas.getContext('2d');

        const stream = canvas.captureStream(30);
        const mimeType = MediaRecorder.isTypeSupported('video/mp4;codecs=h264') ? 'video/mp4;codecs=h264' : 
                         MediaRecorder.isTypeSupported('video/webm;codecs=h264') ? 'video/webm;codecs=h264' : 'video/webm';
        
        const recorder = new MediaRecorder(stream, { mimeType, videoBitsPerSecond: 5000000 });
        const chunks = [];
        recorder.ondataavailable = e => chunks.push(e.data);

        let active = true;
        function draw() {
            if (!active) return;
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            requestAnimationFrame(draw);
        }
        draw();

        recorder.onstop = () => {
            active = false;
            const blob = new Blob(chunks, { type: mimeType });
            const url = URL.createObjectURL(blob);
            const ext = mimeType.includes('mp4') ? 'mp4' : 'webm';

            videoEl.src = url;
            previewArea.style.display = "block";
            status.innerText = "ç”Ÿæˆå®Œäº†ï¼";

            const dl = document.getElementById('download-link');
            dl.href = url;
            dl.download = `converted_video.${ext}`;
            
            dropZone.classList.remove('disabled');
        };

        recorder.start();
        setTimeout(() => recorder.stop(), 3500);
    }

    document.getElementById('tweet-btn').onclick = () => {
        const text = encodeURIComponent(document.getElementById('tweet-text').value);
        window.open(`https://twitter.com/intent/tweet?text=${text}`, '_blank');
    };

    dropZone.ondragover = (e) => { e.preventDefault(); dropZone.style.borderColor = "var(--primary)"; };
    dropZone.ondragleave = () => { dropZone.style.borderColor = "#ddd"; };
    dropZone.ondrop = (e) => { e.preventDefault(); processImage(e.dataTransfer.files[0]); };
</script>

</body>
</html>
